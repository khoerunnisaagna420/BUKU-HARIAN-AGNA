<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Agna's Secret Journal üåøüå∏</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;1,400&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #2d6a4f; --accent: #52b788; --bg: #d8f3dc; --paper: #ffffff; --text: #1b4332; --cover: #40916c; --leaf: 'üçÉ';
        }
        [data-theme="dark"] {
            --primary: #b7e4c7; --accent: #74c69d; --bg: #081c15; --paper: #1b4332; --text: #ffffff; --cover: #04100b; --leaf: '‚ú®';
        }
        [data-theme="pink"] {
            --primary: #ff85a2; --accent: #ffb3c1; --bg: #fff0f3; --paper: #ffffff; --text: #590d22; --cover: #ff85a2; --leaf: 'üå∏';
        }

        * { box-sizing: border-box; transition: 0.4s ease; }
        body { background: var(--bg); font-family: 'Inter', sans-serif; margin: 0; display: flex; justify-content: center; align-items: center; height: 100vh; overflow: hidden; color: var(--text); }

        /* --- ANIMASI GUGURAN --- */
        .falling-container { position: fixed; inset: 0; pointer-events: none; z-index: 5000; }
        .falling-item { position: absolute; opacity: 0.6; animation: fall linear forwards; user-select: none; }
        @keyframes fall { from { transform: translateY(-10vh) rotate(0deg); } to { transform: translateY(110vh) rotate(360deg); } }

        /* --- LOCK SCREEN --- */
        #lockOverlay { position: fixed; inset: 0; background: var(--bg); z-index: 10000; display: none; flex-direction: column; align-items: center; justify-content: center; }

        /* --- COVER --- */
        #bookCover {
            position: fixed; width: 85%; max-width: 350px; height: 520px; background: var(--cover);
            border-radius: 5px 25px 25px 5px; box-shadow: 15px 15px 50px rgba(0,0,0,0.4);
            display: flex; flex-direction: column; justify-content: center; align-items: center; color: white;
            cursor: pointer; z-index: 2000; border-left: 10px solid rgba(0,0,0,0.2);
        }
        #bookCover.opened { transform: perspective(1500px) rotateY(-110deg) translateX(-100%); opacity: 0; pointer-events: none; }

        /* --- APP CONTENT --- */
        #appContainer { width: 100%; height: 100vh; display: none; flex-direction: column; }
        .header { background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); padding: 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid rgba(0,0,0,0.1); }
        .nav-btn { background: var(--primary); border: none; color: var(--bg); padding: 8px 15px; border-radius: 20px; font-size: 12px; font-weight: bold; }

        .main-view { flex: 1; overflow-y: auto; padding: 20px 15px; scroll-behavior: smooth; }
        .paper { width: 100%; max-width: 600px; margin: 0 auto; background: var(--paper); min-height: 95vh; padding: 45px 25px; border-radius: 5px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); border-top: 8px solid var(--accent); position: relative; }
        
        #editor { width: 100%; min-height: 450px; border: none; outline: none; font-size: 17px; line-height: 1.8; resize: none; background: transparent; color: var(--text); overflow: hidden; background-image: linear-gradient(rgba(0,0,0,0.05) 1px, transparent 1px); background-size: 100% 1.8em; }
        #noteTitle { width: 100%; border: none; outline: none; font-family: 'Playfair Display', serif; font-size: 28px; margin-bottom: 20px; color: var(--primary); background: transparent; font-weight: bold; }

        /* --- SETTINGS --- */
        #settingsModal { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: var(--paper); padding: 30px; border-radius: 25px; box-shadow: 0 0 50px rgba(0,0,0,0.4); z-index: 3000; display: none; width: 85%; max-width: 350px; }
        .theme-circle { width: 45px; height: 45px; border-radius: 50%; border: 3px solid rgba(0,0,0,0.1); cursor: pointer; }

        .archive-card { background: var(--paper); padding: 20px; border-radius: 15px; margin-bottom: 15px; border-left: 6px solid var(--accent); position: relative; box-shadow: 0 4px 10px rgba(0,0,0,0.05); }
        .del-btn { position: absolute; top: 15px; right: 15px; background: #ff4d4d; color: white; border: none; padding: 6px 12px; border-radius: 10px; font-size: 11px; }
        .save-btn { position: fixed; bottom: 30px; right: 25px; background: var(--primary); color: var(--bg); border: none; padding: 18px 30px; border-radius: 50px; font-weight: bold; box-shadow: 0 8px 20px rgba(0,0,0,0.2); z-index: 100; }
    </style>
</head>
<body data-theme="sage">

    <div class="falling-container" id="leafContainer"></div>

    <div id="lockOverlay">
        <h2 style="font-family:'Playfair Display'">Locked üîí</h2>
        <input type="password" id="pinIn" style="padding:15px; border-radius:15px; border:2px solid var(--primary); text-align:center; width:160px; font-size:20px;" placeholder="PIN">
        <button class="nav-btn" style="margin-top:20px; padding:12px 30px;" onclick="unlockApp()">Unlock</button>
    </div>

    <div id="bookCover" onclick="openBook()">
        <div style="border:2px solid rgba(255,255,255,0.4); padding:40px; text-align:center; border-radius:10px;">
            <h1 style="font-family:'Playfair Display'; margin:0; font-size:35px;">AGNA</h1>
            <p style="letter-spacing:4px; font-size:12px; margin-top:10px;">SECRET JOURNAL</p>
            <span id="coverEmoji" style="font-size:40px; display:block; margin-top:20px;">üåø</span>
        </div>
        <p style="margin-top:30px; font-size:11px; opacity:0.8; letter-spacing:1px;">TAP TO OPEN</p>
    </div>

    <div id="appContainer">
        <div class="header">
            <button class="nav-btn" onclick="closeBook()">üìî Cover</button>
            <div style="display:flex; gap:10px;">
                <button class="nav-btn" onclick="showSection('write')">Write</button>
                <button class="nav-btn" onclick="showSection('archive')">Archive</button>
                <button class="nav-btn" onclick="toggleSettings()" style="background:#555">‚öôÔ∏è</button>
            </div>
        </div>

        <div class="main-view">
            <div id="writeView">
                <div class="paper">
                    <input type="text" id="noteTitle" placeholder="Title of the day...">
                    <textarea id="editor" placeholder="Write your thoughts here... paper grows with you."></textarea>
                </div>
            </div>
            <div id="archiveView" style="display:none; max-width:600px; margin:0 auto;">
                <h2 style="font-family:'Playfair Display'">Your Memories</h2>
                <div id="archiveList"></div>
            </div>
        </div>

        <button class="save-btn" id="saveBtn" onclick="saveNote()">SAVE üçÉ</button>
    </div>

    <div id="settingsModal">
        <h3 style="margin-top:0; font-family:'Playfair Display'">Settings</h3>
        <p>Pilih Tema & Efek:</p>
        <div style="display:flex; gap:20px; margin-bottom:25px;">
            <div class="theme-circle" style="background:#d8f3dc" onclick="setTheme('sage')"></div>
            <div class="theme-circle" style="background:#1b4332" onclick="setTheme('dark')"></div>
            <div class="theme-circle" style="background:#fff0f3" onclick="setTheme('pink')"></div>
        </div>
        <hr style="opacity:0.2">
        <p>Keamanan:</p>
        <label style="display:block; margin-bottom:10px;"><input type="checkbox" id="lockEnable" onchange="updateLock()"> Aktifkan PIN</label>
        <input type="password" id="newPin" style="width:100%; padding:12px; border-radius:10px; border:1px solid #ddd" placeholder="Set PIN Baru">
        <br><br>
        <button class="nav-btn" style="width:100%; padding:12px;" onclick="toggleSettings()">Save & Close</button>
    </div>

    <script>
        // --- THEME & GUGURAN LOGIC ---
        let currentLeaf = 'üçÉ';
        
        function setTheme(t) {
            document.body.setAttribute('data-theme', t);
            localStorage.setItem('theme', t);
            
            const emoji = document.getElementById('coverEmoji');
            if(t === 'sage') { currentLeaf = 'üçÉ'; emoji.innerText = 'üåø'; }
            else if(t === 'pink') { currentLeaf = 'üå∏'; emoji.innerText = 'üå∏'; }
            else { currentLeaf = '‚ú®'; emoji.innerText = 'üåô'; }
        }

        function spawnLeaf() {
            const container = document.getElementById('leafContainer');
            const leaf = document.createElement('span');
            leaf.className = 'falling-item';
            leaf.innerText = currentLeaf;
            leaf.style.left = Math.random() * 100 + 'vw';
            leaf.style.fontSize = Math.random() * 20 + 15 + 'px';
            leaf.style.animationDuration = Math.random() * 3 + 5 + 's';
            container.appendChild(leaf);
            setTimeout(() => leaf.remove(), 8000);
        }
        setInterval(spawnLeaf, 800);

        // --- CORE APP ---
        function openBook() {
            if(localStorage.getItem('isLocked') === 'true') {
                document.getElementById('lockOverlay').style.display = 'flex';
            } else { proceedOpen(); }
        }
        function proceedOpen() {
            document.getElementById('bookCover').classList.add('opened');
            setTimeout(() => { document.getElementById('appContainer').style.display = 'flex'; }, 300);
        }
        function closeBook() { 
            document.getElementById('bookCover').classList.remove('opened'); 
            document.getElementById('appContainer').style.display = 'none'; 
        }
        function unlockApp() {
            if(document.getElementById('pinIn').value === (localStorage.getItem('pin') || "1234")) {
                document.getElementById('lockOverlay').style.display = 'none'; proceedOpen();
            } else { alert("Wrong PIN!"); }
        }

        // --- SETTINGS ---
        function toggleSettings() { 
            const m = document.getElementById('settingsModal');
            document.getElementById('lockEnable').checked = (localStorage.getItem('isLocked') === 'true');
            m.style.display = m.style.display === 'block' ? 'none' : 'block'; 
        }
        function updateLock() {
            localStorage.setItem('isLocked', document.getElementById('lockEnable').checked);
            if(document.getElementById('newPin').value) localStorage.setItem('pin', document.getElementById('newPin').value);
        }
        setTheme(localStorage.getItem('theme') || 'sage');

        // --- EDITOR ---
        const ed = document.getElementById('editor');
        ed.addEventListener('input', function() { this.style.height = 'auto'; this.style.height = this.scrollHeight + 'px'; });

        // --- NOTES ---
        function saveNote() {
            const title = document.getElementById('noteTitle').value || "Untitled Note";
            const content = ed.value;
            if(!content) return;
            let notes = JSON.parse(localStorage.getItem('agna_notes')) || [];
            notes.unshift({ id: Date.now(), title, content, date: new Date().toLocaleDateString('id-ID') });
            localStorage.setItem('agna_notes', JSON.stringify(notes));
            alert("Saved to Archive! üçÉ");
            document.getElementById('noteTitle').value = ''; ed.value = ''; showSection('archive');
        }
        function deleteNote(id) {
            if(confirm("Hapus kenangan ini?")) {
                let notes = JSON.parse(localStorage.getItem('agna_notes')).filter(n => n.id !== id);
                localStorage.setItem('agna_notes', JSON.stringify(notes)); renderArchive();
            }
        }
        function showSection(s) {
            document.getElementById('writeView').style.display = s === 'write' ? 'block' : 'none';
            document.getElementById('archiveView').style.display = s === 'archive' ? 'block' : 'none';
            document.getElementById('saveBtn').style.display = s === 'write' ? 'block' : 'none';
            if(s === 'archive') renderArchive();
        }
        function renderArchive() {
            const list = document.getElementById('archiveList');
            const notes = JSON.parse(localStorage.getItem('agna_notes')) || [];
            list.innerHTML = notes.map(n => `
                <div class="archive-card">
                    <button class="del-btn" onclick="deleteNote(${n.id})">Hapus</button>
                    <small style="opacity:0.6">${n.date}</small>
                    <h3 style="margin:8px 0; font-family:'Playfair Display'; color:var(--primary)">${n.title}</h3>
                    <p style="font-size:14px; line-height:1.6; opacity:0.9">${n.content.substring(0, 100)}...</p>
                </div>`).join('');
        }
    </script>
</body>
</html>
